<!DOCTYPE html>
<html>

<!-- FILE FOR PERCENT-CHANGE GRAPH -->

<head>
  <meta charset="utf-8">
  <title> INFO3300 Project 2 </title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <link rel='stylesheet' type='text/css' href='css/style.css'>
</head>

  <body>

    <div id='part2'>
        <p class='header'> How Much More Expensive is Canada, Really? </p>
        <h2>Percent Change of Product Prices in Canada vs. The United States</h2>

        <!-- Make sure to copy the "consulted" part when adding to new script -->
        <!-- Consulted: https://bl.ocks.org/stevenwmarks/c23bf3940bc5f1ee4027ccc72097a03b -->
        <script type="text/javascript">
        	var margin = {top: 50, right: 40, bottom: 25, left: 40},
      		width = 1200 - margin.left - margin.right,
      		height = 720 - margin.top - margin.bottom;

          var yScale = d3.scaleLinear()
      		  .range([height,0]);

          var yScaleTop = d3.scaleLinear()
            .range([(yScale(0) -160), (yScale(0)-height)-30]);

          var yScaleBottom = d3.scaleLinear()
            .range([(0+ yScale(0) -30), height -90]);

      	  var xScale = d3.scaleBand()
      		  .rangeRound([0, width])
      		  .paddingInner(0.1);

      	  var div = d3.select("#part2").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

          d3.csv("datasets/percentChange.csv", makePositive, function(error, data) {

            //x is percent change because will be vertical bar graph
            //nice because is long decimal
            yScale.domain(d3.extent(data, function(d){return d.percentChange;})).nice();
		        xScale.domain(data.map(function(d){return d.itemName;}));

            yScaleTop.domain([0, 1.6]);
            yScaleBottom.domain([-.223, 0]);

            //So we dont need to alter the x-tick marks later
            var displayPercentage = d3.format("1.0%");

		        var yAxisTop = d3.axisLeft()
    				  .scale(yScaleTop)
    				  .tickFormat(displayPercentage);

            var yAxisBottom = d3.axisLeft()
    				  .scale(yScaleBottom)
              .ticks(4)
    				  .tickFormat(displayPercentage);
              //.ticks(-10);

            var svg = d3.select("#part2")
  		        .append("svg")
                //Adding back the margins subtracted before to get back to 1200
                .attr("width",width + margin.left + margin.right)
                .attr("height",height + margin.top + margin.bottom)
  			      .append("g")
                .attr("transform","translate("+margin.left+","+margin.top+")");

            var barLines = svg.selectAll(".bar")
              .data(data)
              .enter()
              .append("rect")
                //Setting CSS name for styling colors
              	.attr("class",function(d){return "bar bar_"+(d.percentChange<0 ? "negative":"positive"); })
              	.attr("x",function(d){return xScale(d.itemName);})
              	.attr("y",function(d){
                  if(d.percentChange > 0 ){
                    return yScale(Math.max(0,d.percentChange))-30;
                  }
                  else if(d.percentChange < 0){
                    return yScale(Math.max(0,d.percentChange))+30;
                  }
                })

                //Consulted https://github.com/d3/d3-scale for width/height
              	.attr("width",xScale.bandwidth())
                //Returns width of each band
              	.attr("height",function(d){
                    return Math.abs(yScale(d.percentChange)-yScale(0));
                })
                // function(d,i){ return height - y(d.percent); });

                //tooltip usede to give information on the certain bar while
                //greying out the rest of them
                .on("mouseover", function(d) {
                  var itemDisplay = barLines.filter(function(f) {
                      return f.itemName != d.itemName;
                  });
                  itemDisplay.style("opacity",0.2);

                	div.transition()
                	 .duration(200)
                   .style("opacity", 1.0);

                  //Function used to display dollar sign in the tooltip
                	div.html("Item Name: " + d.itemName.toLowerCase()+"<br/>" +
                           "Canada Price: $" + d3.format(",.2f")(d.canadaPrice)+"<br/>"+
                           "United States Price: $" + d3.format(",.2f")(d.usPrice)+"<br/>"+
                           "Net change: $" + d3.format(",.2f")(d.netChange)+"<br/>"+
                           "<b>Percent change: " + d3.format("1.0%")(d.percentChange)+"</b><br/>")

                  /* Consulted: https://bl.ocks.org/stevenwmarks/c23bf3940bc5f1ee4027ccc72097a03b
                    for formatting here */
                    .style("left",(d3.event.pageX)+"px")
                    .style("top",(d3.event.pageY - 28)+"px");
                })

                //Get rid of tooltip
                .on("mouseout", function(d){
                  var itemDisplay = barLines.filter(function(f) {
                      return f.itemName != d.itemName;
                  })
                  itemDisplay.style("opacity",1)

                  div.transition()
                		.duration(500)
                		.style("opacity", 0);
                });

            svg.append("g")
        			.call(yAxisTop);

            svg.append("g")
        			.call(yAxisBottom);

          /*Referenced https://bl.ocks.org/d3noob/23e42c8f67210ac6c678db2cd07a747e
            svg.append("text")
              .attr("transform",
                    "translate("+(width/2)+","+(height+margin.top+10)+")")
              .style("text-anchor", "middle")
              .text("Item");
          */

        		// add tickNegative to color the bars blue (for U.S.)



          /* Consulted: https://bl.ocks.org/stevenwmarks/c23bf3940bc5f1ee4027ccc72097a03b */

            var myImages = svg.append("g")
              .selectAll('image')
              .data([
                "images/milk.jpg",
                "images/chicken.jpg",
                "images/flour.jpg",
                "images/eggs.png",
                "images/groundBeef.jpg",
                "images/porkchops.png",
                "images/bread.jpg",
                "images/apples.png",
                "images/roundSteak.png",
                "images/bananas.png",
                "images/cheese.png",
                "images/macaroni.jpg",
                "images/bacon.png",
                "images/potatoes.jpg",
                "images/sugar.jpg"])
              .enter().append('image')
              .attr("xlink:href", function(d){
                return d;
              })
              .attr("width", 55)
              .attr("height", 55)
              .data([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])
              .attr('x', function(d){return (d*75) - 70})
              .attr('y', yScale(0) -27);
        	});

          function makePositive(d) {
            d.percentChange = +d.percentChange;
            return d;
          }
        </script>

    </div>

  </body>

</html>
